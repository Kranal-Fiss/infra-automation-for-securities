---
- name: Step 4. PIM-SM 및 RP 멀티캐스트 망 구축
  hosts: arista
  gather_facts: no

  tasks:
    - name: 4.1. 전역 멀티캐스트 라우팅 활성화
      arista.eos.eos_config:
        lines:
          - ip multicast-routing

    - name: 4.2. 인터페이스별 PIM Sparse-Mode 설정
      arista.eos.eos_config:
        lines:
          - ip pim sparse-mode
        parents: "interface {{ item.key }}"
      loop: "{{ interfaces | dict2items }}"

    - name: 4.3. Loopback0 인터페이스 PIM 활성화 (RP 도달용)
      arista.eos.eos_config:
        lines:
          - ip pim sparse-mode
        parents: interface Loopback0

    - name: 4.4. 정적 RP(Rendezvous Point) 주소 지정
      arista.eos.eos_config:
        lines:
          - ip pim rp-address {{ rp_address }}

    - name: 4.5. IGMP 버전 설정 (호스트 접점 Et3 전용)
      arista.eos.eos_config:
        lines:
          - ip igmp version 2
        parents: interface Ethernet3